{% extends "layout.html" -%}

{% block js %}
    <!-- load libraries from CDN to decrease page load time -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.4/angular.min.js" integrity="sha256-jFCqhWdzGFjoG8/SAncY2afI/Xv1TPSWSZrb9dpXQbk=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.1/clipboard.min.js" integrity="sha256-El0fEiD3YOM7uIVZztyQzmbbPlgEj0oJVxRWziUh4UE=" crossorigin="anonymous"></script>
    <!-- custom JS -->
    <script src="{{ url_for("static", filename="js/dist/logoutTimer.min.js") + "?build=" + config['BUILD_ID'] }}"></script>
    <script src="{{ url_for("static", filename="js/dist/entries.min.js") + "?build=" + config['BUILD_ID'] }}"></script>
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for("static", filename="css/dist/entries.min.css") + "?build=" + config['BUILD_ID'] }}" />
{% endblock %}

{% block body %}
    {% raw %}
    <h1 class="title">PassZero Entries</h1>
    <div id="num-entries" ng-cloak>
        <span ng-if="!ctrl.loadedEntries">Loading entries...</span>
        <span ng-if="ctrl.loadedEntries">You have {{ ctrl.entries.length }} {{ (entries.length === 1 ? "entry" : "entries") }}</span>
    </div>

    <form id="search-form" ng-if="ctrl.loadedEntries && ctrl.entries.length > 0"
        ng-submit="ctrl.submitSearch()" ng-cloak>
        <div class="form-group has-feedback">
            <input type="text" name="search" id="search" class="form-control"
                placeholder="search"
                autofocus="true"
                ng-change="ctrl.submitSearch()"
                ng-model="ctrl.search" />
            <i class="glyphicon glyphicon-search form-control-feedback"></i>
        </div>
    </form>

    <div id="entry-container" ng-cloak>
        <div ng-if="ctrl.loadedEntries && ctrl.entries.length === 0">
            <div class="empty-msg">No entries yet. Try <a href="/entries/new">making some</a>.</div>
        </div>

        <div ng-repeat="entry in ctrl.filteredEntries track by entry.id" ng-cloak>
            <div class="entry" id="entry-{{ entry.id }}">
                <div class="entry-title account">{{ entry.account }}</div>
                <div ng-if="!entry.is_encrypted" class="username">{{ entry.username }}</div>
                <div ng-if="!entry.is_encrypted" class="password hidden-toggle password-hidden"
                    ng-click="ctrl.toggleHidden(entry)">
                    <span class="inner-password" id="inner-password-{{ entry.id }}">{{ entry.password }}</span>
                </div>
                <div ng-if="entry.extra && !entry.is_encrypted">
                    <div class="extra-container">
                        <label for="extra">Extra Info</label>
                        <div name="extra" class="extra hidden-toggle password-hidden">{{ entry.extra }}</div>
                    </div>
                </div>
                <div class="entry-panel">
                    <button type="button" ng-if="!entry.is_encrypted"
                        data-clipboard-text="{{ entry.password }}"
                        class="btn btn-success copy-pwd-btn"
                        data-toggle="tooltip">Copy Password</button>
                    <button type="button" class="btn btn-warning edit-btn"
                        ng-click="ctrl.editEntry(entry.id)">Edit</button>
                    <span ng-if="entry.is_encrypted">
                        <button type="button" class="btn btn-info decrypt-btn"
                            ng-click="ctrl.decryptEntry($event, entry, $index)">Decrypt
                        </button>
                    </span>
                    <span ng-if="!entry.is_encrypted">
                        <button type="button" class="btn btn-info show-hide-btn"
                            onclick="showHidePass(event)">Show
                        </button>
                    </span>
                    <button type="button" class="btn btn-danger" class="delete-btn"
                        ng-click="ctrl.deleteEntry(entry)">Delete</button>
                </div>
            </div>
        </div>
    </div>
    {% endraw %}
    <form class="hidden">
        <input type="hidden" name="csrf_token" id="csrf_token" value="{{ csrf_token() }}" />
    </form>
{% endblock %}
